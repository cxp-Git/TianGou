<template>
    <div>
        <div class="box">
          <img :src="show_userPhotoURL">
          <div style="margin-top: 5px;width: 175px;transform: translate(50%);position: absolute;right: 50%">
            <span class="btn btn-info fileinput-button" @click="click_browse">
              <span>浏览</span>
              <input ref="img_input" @change="change" type="file" accept="image/jpeg,image/jpg,image/png,image/svg"  >
            </span>
            <span class="btn btn-success fileinput-button" @click="click_submit">提交</span>
          </div>

        </div>
    </div>
</template>

<script>
    export default {
        name: "changeUserPhoto",
      data(){
          return{
            imgFile:undefined,
            userPhoto_URL:undefined
          }
      },
      computed:{
        show_userPhotoURL(){
          if (undefined == this.userPhoto_URL)
            return this.$store.getters.getUserPhotoURL();
          else {
            return this.userPhoto_URL;
          }
        }
      },
      methods:{
        click_browse(){
            this.$refs.img_input.click()
          },
        change(){
          this.imgFile = this.$refs.img_input.files[0];
          var tempThis = this;
          var reader = new FileReader();
          reader.onload = function (e) {
            tempThis.userPhoto_URL = e.target.result;
          };
          reader.readAsDataURL(this.imgFile)
        },
        click_submit(){
          if (undefined == this.imgFile){
            this.$store.state.status = '请先点击“浏览”添加图片';
            return;
          }

          let formData = new FormData();
          formData.append('file', this.imgFile);

          let config = {
            headers:{'Content-Type':'multipart/form-data'}
          };


          this.$axios.post('/images/addUserPhotoByUserId', formData, config)
            .then(res=>{
              if (this.$store.getters.getResultDispose(res)){
                var store_userPhoto = this.$store.state.userPhoto;
                var userPhoto = res.data.data;
                if (undefined == store_userPhoto || '' == store_userPhoto){
                  this.$axios.get('/user/changeUserPhotoByUserId',{
                    params:{
                      userPhoto:userPhoto
                    }
                  }).then(res=>{
                      if (this.$store.getters.getResultDispose(res)){
                        window.location.reload();
                      }
                    });
                } else {
                  window.location.reload();
                }
              }
            });







        },
      }
    }
</script>

<style scoped>
  .box{

    margin-left: 28%;
    width: 300px;
    position: relative;
  }

  img{
    width: 300px;
    height: 300px;
  }

  .fileinput-button{
    cursor: pointer;
    border-radius: 4px;
    width: 85px;
    height: 40px;
  }
  .fileinput-button input{
    display: none;
  }
  span{
    font-size: 18px;
  }

</style>
